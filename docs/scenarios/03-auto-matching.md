# 演示脚本 03: 自动撮合与资产结算

## 场景目标
演示平台核心撮合引擎的自动化能力：当买卖双方价格重叠时，系统如何瞬间完成成交，并更新双方的资产持仓和历史成交记录。

## 角色分配
*   **角色 A**: 海汽大宗 (买方)
*   **角色 B**: 沙钢贸易 (卖方)

## 演示准备
1. **窗口 A (买方)**: 登录 `海汽大宗`。
2. **窗口 B (卖方)**: 登录 `沙钢贸易`。
3. **窗口 C (观察层)**: 在两窗口中均选择同一个品种（如 `螺纹钢`），并并排摆放。

## 演示脚本

### 步骤 1: 卖方建立卖盘深度
1.  **操作**: 角色 B (卖方) 进入系统，发布 `螺纹钢` 报价：`价格: 3850`, `数量: 100`。
2.  **解说**: *“卖方在市场中挂出了一笔具有吸引力的实盘价格。”*

### 步骤 2: 买方积极买入触发撮合
1.  **操作**: 角色 A (买方) 通过市场行情发现 `3850` 的挂单。
2.  **动作**: 角色 A 直接在报价单输入 `价格: 3850`, `数量: 50`。点击 `确认发布买入报价`。
3.  **系统反应**: 
    *   点击发布的瞬间，行情板块的 `卖1` 报价数量从 `100` 减少为 `50`。
    *   底部“最新成交记录”刷新，出现一笔：价格 `3850`, 数量 `50` 的成交单。
4.  **解说**: *“看！当我的买盘价格触及卖方的挂单时，撮合引擎在毫秒级完成了匹配。剩余的 50 吨卖盘依然留在场内等待后续交易。”*

### 步骤 3: 资产与结算验证
1.  **操作**: 点击顶部标签 `我的资产`。
2.  **视觉重点**: 
    *   在“当前挂单”中，看到这笔成交的订单状态变为 `已成交 (FILLED)` 或 `部分成交`。
    *   在下方的“结算历史”中，出现了这笔详细的结算单，状态显示为“● 已清算”。
3.  **解说**: *“成交后，系统自动同步至清算模块，生成具有法律效力的电子结算凭证。”*

## 测试验证点
- [ ] 交重叠时，是否立即产生新的 `trade` 对象？
- [ ] 撮合后，买卖双方的 `order` 剩余数量是否正确扣除？
- [ ] 底部成交流是否按时间倒序排列？
