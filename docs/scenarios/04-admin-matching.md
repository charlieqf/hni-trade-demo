# 演示脚本 04: 管理员人工撮合干预

## 场景目标
演示平台在复杂交易环境下的灵活性：当市场存在无法自动撮合的零散挂单时，管理员（监管端）如何通过人工干预完成意向匹配。

## 角色分配
*   **角色 A**: 海汽大宗 (买方)
*   **角色 B**: 沙钢贸易 (卖方)
*   **角色 C**: HNI 监管端 (管理员)

## 演示准备
1. **窗口 A (买方)**: 登录 `海汽大宗`。
2. **窗口 B (卖方)**: 登录 `沙钢贸易`。
3. **窗口 C (管理员)**: 在另一个浏览器或无痕窗口登录 `HNI 监管端 (管理员)`。
4. **数据准备**: 
   * 买方在窗口 A 发布一个价格较低的买单。
   * 卖方在窗口 B 发布一个价格稍高的卖单（确保不自动对冲）。

## 演示脚本

### 步骤 1: 建立待撮合池
1.  **操作**: 角色 A (买方) 发布 `螺纹钢` 买盘：`价格: 3820`, `数量: 30`。
2.  **操作**: 角色 B (卖方) 发布 `螺纹钢` 卖盘：`价格: 3830`, `数量: 50`。
3.  **现状**: 价格不重叠，系统不会自动成交。

### 步骤 2: 管理员介入匹配
1.  **操作**: 角色 C (管理员) 进入系统，点击上方 `人工撮合` 标签。
2.  **视觉重点**: 
    *   页面左侧显示：`买方池 (待撮合)`，能看到海汽大宗的 30 吨申买单。
    *   页面右侧显示：`卖方池 (待撮合)`，能看到沙钢贸易的 50 吨申卖单。
3.  **动作**: 
    *   管理员勾选左侧的买单，勾选右侧的卖单。
    *   调整成交价格为双方均认可的中位价 `3825`。
    *   点击 `执行人工撮合`。
4.  **结果**: 
    *   弹出“撮合执行成功”提示。
    *   买卖双方的挂单从“人工撮合”池中消失。
    *   行情区域显示一笔成交价为 `3825` 的新成交。
5.  **解说**: *“监管端拥有全局视角，可以针对线下谈妥的非标成交或价格微差订单进行人工强制匹配，确保每一笔交易意图都能被系统合规记录。”*

### 步骤 3: 验证清算属性
1.  **操作**: 管理员切换回 `我的资产` (或由买卖双方角色查看各自的资产页)。
2.  **视觉重点**: 在“结算历史”中找到该笔成交记录。
3.  **关键细节**: 
    *   “撮合方式”一栏明确显示为系统黄色标签：**人工撮合 (MANUAL)**。
    *   点击查看仓单，价格与成交量完全吻合管理员刚才的人工输入。
4.  **解说**: *“系统对所有人工干预的操作都有详尽的审计留痕。在结算历史中，我们可以清晰分辨出哪些是引擎自动匹配，哪些是应业务需求进行的人工强制撮合，确保交易全链路透明合规。”*

## 测试验证点
- [ ] 管理员是否能同时看到所有用户的订单（而非仅自己的）？
- [ ] 选中两个订单后，系统是否能计算合理的成交数量（两者取小）？
- [ ] 人工撮合产生的成交，在 `matchedBy` 字段是否标记为 `MANUAL`？
- [ ] “人工撮合”标签页是否仅对 `ADMIN` 角色可见？
- [ ] 结算历史中，人工撮合记录是否正确带有“人工撮合”对应的标签显示？
